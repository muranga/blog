<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Deploying Hugo static site with Snap-ci &middot; James Muranga</title>

  
  <link rel="stylesheet" href="http://localhost:1313//css/poole.css">
  <link rel="stylesheet" href="http://localhost:1313//css/hyde.css">
  <link rel="stylesheet" href="http://localhost:1313//css/poole-overrides.css">
  <link rel="stylesheet" href="http://localhost:1313//css/hyde-overrides.css">
  <link rel="stylesheet" href="http://localhost:1313//css/hyde-x.css">
  <link rel="stylesheet" href="http://localhost:1313//css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="ansible, golang">
  <link rel="author" href="http://plus.google.com/MurangaJames">
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <img src="http://www.gravatar.com/avatar/8376ac53dea210d3578b33dbf4c3fd9f?s=200" alt="gravatar">
      <h1>James Muranga</h1>
      <p class="lead"><p>Dev</p>
</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://localhost:1313//">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/jamesmura/"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      <a href="https://twitter.com/murangajames"><i class="fa fa-twitter-square fa-3x"></i></a>
      </li>
    </ul>

    <p>Copyright &copy; 2015 <a href="http://localhost:1313//license">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1>Deploying Hugo static site with Snap-ci</h1>
    <span class="post-date">Apr 8, 2015 &middot; 2 minute read &middot; <a href="http://localhost:1313/blog/2015/04/08/deploying-hugo-static-site-with-snap-ci/#disqus_thread">Comments</a>
    </span>
    <p>We recently got inspired to start blogging again. So my approach was to go ahead and look out for the coolest tools I could use to build my blog. I found a few but narrowed down on a static site built with <a href="http://gohugo.io/">Hugo</a>.</p>

<p><a href="http://gohugo.io/">Hugo</a> (a static site generator), basically allows you to write up the posts in markdown which it later converts to Html for you, similar to how <a href="http://jekyllrb.com/">jekyll</a> works. So I went ahead and created a new site without any post added it to github <a href="https://github.com/muranga/blog">here</a>. Having the blog on github allowed me automate things a little. I created a script to build the site and package it in a tar.</p>

<p>Here is what the code to package the site looks like:</p>

<pre><code>#! /bin/bash
set -e
OUTPUT_FOLDER='builds'
mkdir -p $OUTPUT_FOLDER
CURRENT_REVISION=`git rev-parse --short  HEAD`
OUTPUT_FILE=&quot;$OUTPUT_FOLDER/blog-$CURRENT_REVISION.tar.gz&quot;
hugo
tar -zcf $OUTPUT_FILE  public
</code></pre>

<p>The script allowed me to create a zipped package of the site for a specific revision of the repository. With that setup I added <a href="https://github.com/muranga/blog">my blog</a> to <a href="https://snap-ci.com/muranga/blog/branch/master">Snap CI</a> , that means whenever I push changes to github the static site gets packaged.</p>

<p>The next logical step was to deploy the site to the server and for that I used ansible.
This is what the playbook looks like:</p>

<pre><code>  tasks:
  - {apt: update_cache=yes cache_valid_time=3600}
  - apt: pkg={{item}} state=latest
    with_items: [nginx]
  - {user: 'name=blog generate_ssh_key=yes ssh_key_bits=2048'}
  - {file: 'name=/home/blog/www state=directory'}
  - {file: 'name=/home/blog/tmp state=directory'}
  - {unarchive: src=../builds/blog-latest.tar.gz dest=/home/blog/www}
  - {file: path=/etc/nginx/sites-enabled/default state=absent}
  - template: 'src=nginx.conf.j2 dest=/etc/nginx/nginx.conf'
  - {template: 'src=blog-nginx.conf.j2 dest=/etc/nginx/sites-enabled/blog.conf'}
  - {service: 'name=nginx state=restarted'}
</code></pre>

<p>The playbook gets makes sure a folder exists to host the site, copies then unarchives the tar package in the correct path and then makes sure Nginx is properly configured to serve the site.</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "blogmjamocom";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "blogmjamocom";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://localhost:1313//js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script>
  var _gaq=[['_setAccount','Your Google Analytics tracking code'],['_trackPageview']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<script>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>